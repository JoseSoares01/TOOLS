<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora IVA</title>
  <link rel="stylesheet" href="/css/styles_gastos.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;700;800&display=swap" rel="stylesheet">
  <script>
    const usuarioLogado = localStorage.getItem('usuarioLogado');
    if (!usuarioLogado) {
      alert('Você precisa fazer login para acessar esta página.');
      window.location.href = 'https://ferramentasservinform/login.html';
    }
  </script>
</head>
<body>
  <img src="/images/home-button.png" width=40px class="home-button" onclick="location.href = '/pages/Tools.html';">
  
  <div class="container">
    <div>
      <h2>Calculadora de IVA</h2>
      <p class="subtitle">Calcule o IVA das suas despesas de forma rápida e precisa</p>

      <div class="input-group">
        <label>Total da Fatura (com IVA)</label>
        <input type="number" id="total" step="0.01" placeholder="Ex: 99.25">

        <div class="iva-options">
          <h3>Valores de IVA por Taxa</h3>
          
          <div class="iva-option">
            <input type="checkbox" id="check0" checked>
            <label for="check0">0%</label>
            <input type="number" id="iva0" step="0.01" placeholder="0.00">
            <span>€</span>
          </div>

          <div class="iva-option">
            <input type="checkbox" id="check6" checked>
            <label for="check6">6%</label>
            <input type="number" id="iva6" step="0.01" placeholder="0.37">
            <span>€</span>
          </div>

          <div class="iva-option">
            <input type="checkbox" id="check13" checked>
            <label for="check13">13%</label>
            <input type="number" id="iva13" step="0.01" placeholder="0.00">
            <span>€</span>
          </div>

          <div class="iva-option">
            <input type="checkbox" id="check23" checked>
            <label for="check23">23%</label>
            <input type="number" id="iva23" step="0.01" placeholder="17.32">
            <span>€</span>
          </div>
        </div>

        <button onclick="calcular()">Calcular</button>

        <div class="resultado" id="resultado" style="display:none;">
          <p><strong>Valor com IVA:</strong> <span id="comIVA">0.00</span> €</p>
          <p><strong>Valor sem IVA:</strong> <span id="semIVA">0.00</span> €</p>
          <p><strong>IVA aplicado:</strong> <span id="taxasAplicadas">—</span></p>
          <p><strong>Resultado do IVA:</strong> <span id="valorIVA">0.00</span> €</p>
          <p><strong>Total (com IVA + sem IVA):</strong> <span id="totalCombinado">0.00</span> €</p>

          <div class="total-linhas" style="margin-top: 10px;">
            <label>Total de Linhas: <span id="totalLinhas">0</span></label>
          </div>
          <div class="total-valores">
            <label>Total de Valores: <span id="totalValores">0.00 €</span></label>
          </div>

          <div style="margin-top: 12px;">
            <table id="tabelaDetalhes" style="width: 100%; border-collapse: collapse; display: none;">
              <thead>
                <tr>
                  <th style="text-align:left; padding: 6px;">Taxa</th>
                  <th style="text-align:right; padding: 6px;">Base sem IVA</th>
                  <th style="text-align:right; padding: 6px;">IVA</th>
                  <th style="text-align:right; padding: 6px;">Total com IVA</th>
                </tr>
              </thead>
              <tbody id="detalhesBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    function calcular() {
      const total = parseFloat(document.getElementById("total").value) || 0;
      const iva0 = parseFloat(document.getElementById("iva0").value) || 0;
      const iva6 = parseFloat(document.getElementById("iva6").value) || 0;
      const iva13 = parseFloat(document.getElementById("iva13").value) || 0;
      const iva23 = parseFloat(document.getElementById("iva23").value) || 0;

      const checkboxes = [
        {id: "check0", checked: document.getElementById("check0").checked},
        {id: "check6", checked: document.getElementById("check6").checked},
        {id: "check13", checked: document.getElementById("check13").checked},
        {id: "check23", checked: document.getElementById("check23").checked}
      ];

      const taxas = [
        {nome: "0%", taxa: 0, iva: iva0, ativo: checkboxes[0].checked},
        {nome: "6%", taxa: 0.06, iva: iva6, ativo: checkboxes[1].checked},
        {nome: "13%", taxa: 0.13, iva: iva13, ativo: checkboxes[2].checked},
        {nome: "23%", taxa: 0.23, iva: iva23, ativo: checkboxes[3].checked},
      ];

      let baseTotal = 0, ivaTotal = 0, totalCalculado = 0;
      let linhasAtivas = 0;
      let linhasDetalhes = "";

      const taxasAtivas = [];
      taxas.forEach(t => {
        if (t.ativo && t.iva > 0) {
          const base = t.taxa > 0 ? (t.iva / t.taxa) : t.iva;
          const linhaTotal = base + t.iva;

          baseTotal += base;
          ivaTotal += t.iva;
          totalCalculado += linhaTotal;
          linhasAtivas++;
          taxasAtivas.push(t.nome);

          linhasDetalhes += `
            <tr>
              <td style="text-align:left; padding: 6px;">${t.nome}</td>
              <td style="text-align:right; padding: 6px;">${base.toFixed(2)} €</td>
              <td style="text-align:right; padding: 6px;">${t.iva.toFixed(2)} €</td>
              <td style="text-align:right; padding: 6px;">${linhaTotal.toFixed(2)} €</td>
            </tr>
          `;
        }
      });

      // Atualizar os totais
      document.getElementById("semIVA").textContent = baseTotal.toFixed(2);
      document.getElementById("valorIVA").textContent = ivaTotal.toFixed(2);
      document.getElementById("comIVA").textContent = total.toFixed(2);
      document.getElementById("taxasAplicadas").textContent = taxasAtivas.length ? taxasAtivas.join(", ") : "—";
      document.getElementById("totalCombinado").textContent = (baseTotal + ivaTotal).toFixed(2);
      document.getElementById("totalLinhas").textContent = linhasAtivas;
      document.getElementById("totalValores").textContent = totalCalculado.toFixed(2) + " €";

      // Tabela de detalhes
      document.getElementById("detalhesBody").innerHTML = linhasDetalhes;
      document.getElementById("tabelaDetalhes").style.display = linhasAtivas > 0 ? "table" : "none";

      // Mostrar resultado
      document.getElementById("resultado").style.display = "block";
    }

    // Adicionar funcionalidade aos checkboxes
    document.addEventListener('DOMContentLoaded', function() {
      const checkboxes = ['check0', 'check6', 'check13', 'check23'];
      checkboxes.forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
          const inputId = id.replace('check', 'iva');
          const input = document.getElementById(inputId);
          input.disabled = !this.checked;
          if (!this.checked) {
            input.value = '';
          }
        });
      });
    });
  </script>
</body>
</html>
